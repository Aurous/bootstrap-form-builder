<!doctype html>
 
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Bootstrap 3 Form Builder</title>
	<link rel="stylesheet" href="css/jquery.ui.theme.css" />
	<link rel="stylesheet" href="css/bootstrap.css" />
	<script src="js/jquery.min.js"></script>
	<script src="js/vue.js"></script>
	<script src="js/jquery.ui.min.js"></script>
	<script src="js/bootstrap.js"></script>
	<style>
		.droppable-active { background-color: #ffe !important; }
		.tools a { cursor: pointer; font-size: 80%; }
		.form-body .col-md-12 { min-height: 500px !important; overflow-y:auto !important; max-height:500px !important; }
		.draggable { cursor: move; }
		.form-group.dropped{ height: 100px; }
		.container { max-width: 1500px !important; }
	</style>
	<script>
	$(document).ready(function() {
		setup_draggable();	
		
	});
	var space = 1;
	var setup_draggable = function() {
		$( ".draggable" ).draggable({
			appendTo: "body",
			helper: "clone"
		});
		$( ".droppable" ).droppable({
			accept: ".draggable",
			helper: "clone",
			hoverClass: "droppable-active",
			drop: function( event, ui ) {
				$(".empty-form").remove();
				var $orig = $(ui.draggable)
				if(!$orig.hasClass("dropped")) {
					if(!$("#"+$orig.attr('id')+".dropped").length){
						var col_size = $(ui.draggable).attr('data-size').split(",");
						var $el  = $orig.clone().addClass("dropped").addClass("col-xs-"+col_size[0]).css({"position": "static", "left": null, "right": null}).appendTo(this);
						$($el).find("p").remove();
						if($($el).attr("id") == "space"){
							$el.attr("id","space-"+space);
							space++;
							$('<p class="tools"><a class="remove-link">Remove</a> | <a class="edit-size">Size</a></p>').appendTo($el);
						}else{
							$('<p class="tools"><a class="remove-link">Remove</a> | <a class="edit-size">Size</a> | <a class="edit-css">CSS</a> | <a class="edit=events">Events</a></p>').appendTo($el);
						}
						
						
					}
				} else {
					if($(this)[0]!=$orig.parent()[0]){
						var $el = $orig.clone().css({"position": "static", "left": null, "right": null}).appendTo(this);
						$orig.remove();
					}
				}
			}
		}).sortable();
	}
	
	var get_modal = function(modal_id, type, sizes) {
		if(typeof(type) == "string"){
			var modal_html = '<div id="modal-'+modal_id+'-'+type+'" class="modal" style="overflow: auto;" tabindex="-1">'
			modal_html +=		'<div class="modal-dialog">'
			modal_html +=				'<div class="modal-content">'
			modal_html +=					'<div class="modal-header">'
			modal_html +=						'<a type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</a>'
			modal_html +=						'<h4 class="modal-title">Change '+type+'</h4>'
			modal_html +=					'</div>'
			modal_html +=					'<div class="modal-body ui-front">'
				if(type == "Size"){
					var size_options = '';
					$.each(sizes.split(","),function(key, value){
						size_options += "<option value="+value+">"+value+"</option>";
					});
			modal_html +=						'<div class="form-group col-xs-10">'
			modal_html +=							'<select class="form-control" id="n-columns">'+size_options+'</select>'
			modal_html +=						'</div>'
			modal_html +=						'<button class="btn btn-success">Change</button>'
				}else if(type == "CSS"){
			modal_html +=						'<button class="btn btn-success">Close</button>'
				}
				
			modal_html +=					'</div>'
			modal_html +=				'</div>'
			modal_html +=			'</div>'
			modal_html +=		'</div>'
			return modal = $(modal_html).appendTo(document.body);
		}
	};
	
	
	$(document).on("click", ".edit-size", function(ev) {
		var $el = $(this).parent().parent();
		var modal_id = '#modal-'+$el.attr("id")+'-size';
		if(!$(modal_id).length){
			var $modal = get_modal($el.attr("id"), "Size", $el.attr("data-size")).modal("show");
		}else{
			var $modal = $(modal_id).modal("show");
			
		}
		$modal.find(".btn-success").click(function() {
			var size = $modal.find("select").val();
			$el.removeClass().addClass('form-group').addClass('draggable').addClass('ui-draggable').addClass('dropped').addClass('col-xs-'+size);
			$modal.modal("hide");
			return false;
		})
	});
	
	$(document).on("click", ".edit-css", function(ev) {
		var $el = $(this).parent().parent();
		var modal_id = '#modal-'+$el.attr("id")+'-css';
		if(!$(modal_id).length){
			var $modal = get_modal($el.attr("id"), "CSS", $el.attr("data-size")).modal("show");
		}else{
			var $modal = $(modal_id).modal("show");
			
		}
		$modal.find(".btn-success").click(function() {
			$modal.modal("hide");
			return false;
		})
	});
	
	$(document).on("click", ".remove-link", function(ev) {
		$removing = $(this).parent().parent();
		var modal_remove = "#modal-"+$removing.attr("id");
		$removing.remove();
		if($(modal_remove).length){
			$(modal_remove).remove();
		}
	});
	
	$(document).on("click", ".add-border", function(){
		if($(this).parent().parent().css("border") == "1px solid rgb(0, 0, 0)"){
			$(this).parent().parent().css("border","");
		}else{
			$(this).parent().parent().css("border", "1px solid rgb(0, 0, 0)");
		}
	});
	
	$(document).on("click", ".show-advanced", function(){
		if($("#update").css("display") == "none"){
			$("#update").show();
		}else{
			$("#update").hide();
		}
	});
	</script>
</head>
<body style="background-color: #ddd;">
	<div id="vue" class="container">
		<div class="row">
			<br />
			<div  class="col-md-2 filters" style="background-color: #fff;">
				<h3>Elements</h3>
				<form role="form-inline">
					<template v-for="element in elements">
						<div v-bind:id="element.id+'_draggable'" v-bind:data-size="element.colsize" class="form-group draggable">
							<template v-if="element.label !== ''">
								<label class="form-control" v-bind:for="element.id">{{ element.label }}</label>
							</template>
							<template v-if="input_types.includes(element.type)">
								<input class="form-control" v-bind:name="element.name" v-bind:id="element.id" v-bind:type="element.type" v-bind="element.attributes">
							</template>
							<template v-else-if="element.type == 'select'">
								<select class="form-control" v-bind:id="element.id" v-bind:name="element.name" class="form-control" v-bind="element.attributes">
										<option v-for="option in element.options" v-bind:value="option.value">{{ option.name }}</option>
								</select>
							</template>
							<template v-else-if="element.type == 'textarea'">
								<textarea class="form-control" v-bind:id="element.id" v-bind:name="element.name" >{{ element.value }}</textarea>
							</template>
							<template v-else-if="element.type == 'datalist'">
								<input class="form-control" type="text" v-bind:id="element.id" v-bind:name="element.name" v-bind:list="element.id+'-datalist'">
								<datalist v-bind:id="element.id+'-datalist'">
									<template v-for="option in element.options">
										<option v-bind:value="option.name" v-bind:data-value="option.value"></option>
									</template>
								</datalist>
							</template>
							<template v-else-if="element.type == 'buttons'">
								<button class="form-control" v-bind:name="element.name" v-bind:id="element.id" v-bind:type="element.type" v-bind="element.attributes">{{ element.value }}</button>
							</template>
							<template v-else-if="element.type == 'optgroup'">
								<select class="form-control" v-bind:name="element.name" v-bind:id="element.id" v-bind="element.attributes">
									<template v-for="(item, index) in element.options">
										<optgroup v-bind:label="index">
											<option v-for="option in item" v-bind:value="option.value">{{ option.name }}</option>
										</optgroup>
									</template>
								</select>
							</template>
							<template v-if="element.desc !== ''">
								<p class="help-block">{{ element.desc }}</p>
							</template>
						</div>
					</template>
					<div id="space" class="form-group draggable" data-size="12,11,10,9,8,7,6,5,4,3,2,1">
						<span>Spacing Element</span>
						<p class="help-block">Object used to space items apart</p>
					</div>
				</form>
			</div>
			<div class="col-md-8">
				<div style="background-color: #fff; padding: 20px; ">
					<div class="text-muted empty-form text-center" style="font-size: 24px;">Drag & Drop elements to build form.</div>
					<div class="row form-body  form-inline">
						<div class="col-md-12 droppable sortable">
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-2" style="background-color: #fff;">
				<br />
				<form role="form-inline">
					<input class="form-control " type="button" id="export" name="export" value="Export">
					<br />
					<input class="form-control show-advanced" type="button" id="advanced" name="advanced" value="Advanced">
				</form>
				<br />
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<p id="message" name="message" style="color: red;"></p>
				<form role="form-inline">
					<textarea rows="15" class="form-control" id="update" @input='update' style="display: none;"></textarea>
				</form>
			</div>
		</div>
	</div>
</body>
<script>
	var element_vue = new Vue({
		el: '#vue',
		data: {
			input_types:["button","checkbox","color","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"],
			elements:[
				{"name":"button","id":"button","type":"buttons","colsize":[6,3,2],"label":"","desc":"button that does things","value":"test","attributes":{"disabled":"true"}},
				{"name":"submit","id":"submit","type":"submit","colsize":[6,3,2],"label":"","desc":"Button to submit the form","attributes":{"value":"Submit"}},
				{"name":"textarea","id":"textarea","type":"textarea","colsize":[12,11,10,9],"label":"","desc":"Select Thing Field","value":"testet"},
				{"name":"select","id":"select","type":"select","colsize":[12,11,10,9],"label":"","desc":"Select Thing Field","options":[{"value":"1","name":"option 1"},{"value":"2","name":"option 2"}]},
				{"name":"datalist","id":"datalist","type":"datalist","colsize":[12,11,10,9],"label":"","desc":"Select Thing Field","options":[{"value":"1","name":"something 1"},{"value":"2","name":"option 2"}]},
				{"name":"optgroup","id":"optgroup","type":"optgroup","colsize":[12,11,10,9],"label":"","desc":"Select Thing Field","options":{"test":[{"value":"1","name":"option 1"},{"value":"7","name":"option 7"}],"label":[{"value":"2","name":"option 2"},{"value":"3","name":"option 3"}]}}
			]
		},
		methods: {
			update: function(event){
				try {
					this.elements = JSON.parse(event.target.value);
					$(".col-md-12.droppable.sortable").text("");
					$("#message").text("");
				}catch(err){
					$("#message").text("Error Parsing JSON");
				}
			}
		}
	})
	$("#update").append(JSON.stringify(element_vue.elements));
</script>
</html>