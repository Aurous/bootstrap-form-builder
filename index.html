<!doctype html>
 
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Bootstrap 3 Form Builder</title>
	<link rel="stylesheet" href="css/jquery.ui.theme.css" />
	<link rel="stylesheet" href="css/bootstrap.css" />
	<script src="js/jquery.min.js"></script>
	<script src="js/vue.js"></script>
	<script src="js/jquery.ui.min.js"></script>
	<script src="js/bootstrap.js"></script>
	<style>
		.droppable-active { background-color: #ffe !important; }
		.tools a { cursor: pointer; font-size: 80%; }
		.form-body .col-md-6, .form-body .col-md-12 { min-height: 500px; }
		.draggable { cursor: move; }
		.form-group.dropped{ height: 100px; }
	</style>
	<script>
	$(document).ready(function() {
		setup_draggable();		
	});
	
	var setup_draggable = function() {
		$( ".draggable" ).draggable({
			appendTo: "body",
			helper: "clone"
		});
		$( ".droppable" ).droppable({
			accept: ".draggable",
			helper: "clone",
			hoverClass: "droppable-active",
			drop: function( event, ui ) {
				$(".empty-form").remove();
				var $orig = $(ui.draggable)
				if(!$(ui.draggable).hasClass("dropped")) {
					var el_dropped = "#"+$orig.attr('id')+".dropped";
					if(!$("#"+$orig.attr('id')+".dropped").length){
						var test = $(ui.draggable).attr('data-size').split(",");
						var $el = $orig.clone().addClass("dropped").addClass("col-xs-"+test[0]).css({"position": "static", "left": null, "right": null}).appendTo(this);		
						$($el).find("p").remove();
					}
					$('<p class="tools"><a class="remove-link">Remove</a> | <a class="edit-size">Size</a> | <a class="add-border">Show Border</a></p>').appendTo($el);
				} else {
					if($(this)[0]!=$orig.parent()[0]){
						var $el = $orig.clone().css({"position": "static", "left": null, "right": null}).appendTo(this);
						$orig.remove();
					}
				}
			}
		}).sortable();
	}
	
	var get_modal = function(modal_id, sizes) {
		var size_options = '';
		$.each(sizes.split(","),function(key, value){
			size_options += "<option value="+value+">"+value+"</option>";
		});
		var modal = $('<div id="modal-'+modal_id+'" class="modal" style="overflow: auto;" tabindex="-1">\
			<div class="modal-dialog">\
				<div class="modal-content">\
					<div class="modal-header">\
						<a type="button" class="close"\
							data-dismiss="modal" aria-hidden="true">&times;</a>\
						<h4 class="modal-title">Change Size</h4>\
					</div>\
					<div class="modal-body ui-front">\
						<div class="form-group col-xs-10">\
							<select class="form-control" id="n-columns">'+size_options+'</select>\
						</div>\
						<button class="btn btn-success">Change</button>\
					</div>\
				</div>\
			</div>\
			</div>').appendTo(document.body);
		return modal;
	};
	
	$(document).on("click", ".edit-size", function(ev) {
		var $el = $(this).parent().parent();
		var $el_copy = $el.clone();
		var modal_id = '#modal-'+$el.attr("id");
		var $edit_btn = $el_copy.find(".edit-size").parent().remove();
		if(!$(modal_id).length){
			var $modal = get_modal($el.attr("id"), $el.attr("data-size")).modal("show");
		}else{
			var $modal = $(modal_id).modal("show");
			
		}
		$modal.find(".btn-success").click(function() {
			var size = $modal.find("select").val();
			$el.removeClass().addClass('form-group').addClass('draggable').addClass('ui-draggable').addClass('dropped').addClass('col-xs-'+size);
			$modal.modal("hide");
			return false;
		})
	});
	
	$(document).on("click", ".remove-link", function(ev) {
		$removing = $(this).parent().parent();
		var modal_remove = "#modal-"+$removing.attr("id");
		$removing.remove();
		if($(modal_remove).length){
			$(modal_remove).remove();
		}
	});
	
	$(document).on("click", ".add-border", function(){
		if($(this).parent().parent().css("border") == "1px solid rgb(0, 0, 0)"){
			$(this).parent().parent().css("border","");
		}else{
			$(this).parent().parent().css("border", "1px solid rgb(0, 0, 0)");
		}
	});
	</script>
</head>
<body style="background-color: #ddd;">
	<div class="container">
	<div class="row">
		<br />
		<div id="vue" class="col-md-3" style="background-color: #fff;">
			<h3>Elements</h3>
			<form role="form-inline">
				<template v-for="element in elements">
					<div v-bind:id="element.id+'_draggable'" v-bind:data-size="element.colsize" class="form-group draggable">
						<template v-if="element.label !== ''">
							<label v-bind:for="element.id">{{ element.label }}</label>
						</template>
						<template v-if="input_types.includes(element.type)">
							<input v-bind:name="element.name" v-bind:id="element.id" v-bind:type="element.type" v-bind="element.attributes">
						</template>
						<template v-else-if="element.type == 'select'">
							<select v-bind:id="element.id" v-bind:name="element.name" class="form-control" v-bind="element.attributes">
									<option v-for="option in element.options" v-bind:value="option.value">{{ option.name }}</option>
							</select>
						</template>
						<template v-else-if="element.type == 'textarea'">
							<textarea v-bind:id="element.id" v-bind:name="element.name" >{{ element.value }}</textarea>
						</template>
						<template v-else-if="element.type == 'datalist'">
							<input type="text" v-bind:id="element.id" v-bind:name="element.name" v-bind:list="element.id+'-datalist'">
							<datalist v-bind:id="element.id+'-datalist'">
								<template v-for="option in element.options">
									<option v-bind:value="option.name" v-bind:data-value="option.value"></option>
								</template>
							</datalist>
						</template>
						<template v-if="element.desc !== ''">
							<p class="help-block">{{ element.desc }}</p>
						</template>
					</div>
				</template>
				<div class="form-group draggable" data-size="12,11,10,9,8,7,6,5,4,3,2,1">
					<span>Spacing Element</span>
					<p class="help-block">Object used to space items apart</p>
				</div>
			</form>
		</div>
		<div class="col-md-9">
			<div style="background-color: #fff; padding: 20px; ">
				<div class="text-muted empty-form text-center" style="font-size: 24px;">Drag & Drop elements to build form.</div>
				<div class="row form-body  form-inline">
					<div class="col-md-12 droppable sortable" >
					</div>
				</div>
			</div>
		</div>
	</div>
	</div>
</body>
<script>
var app = new Vue({
	el: '#vue',
	data: {
		input_types:["button","checkbox","color","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"],
		elements:[
			{"name":"button","id":"button","type":"button","colsize":[6,3,2],"label":"","desc":"button that does things","attributes":{"value":"test", "disabled":"true"}},
			{"name":"textarea","id":"textarea","type":"textarea","colsize":[12,11,10,9],"label":"","desc":"Select Thing Field","value":"testet"},
			{"name":"select","id":"select","type":"select","colsize":[12,11,10,9],"label":"","desc":"Select Thing Field","options":[{"value":"1","name":"option 1"},{"value":"2","name":"option 2"}]},
			{"name":"datalist","id":"datalist","type":"datalist","colsize":[12,11,10,9],"label":"","desc":"Select Thing Field","attributes":{"defaultValue":2},"options":[{"value":"1","name":"option 1"},{"value":"2","name":"option 2"}]}
		]
	}
})
</script>
</html>